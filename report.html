<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Farid Musayev">
<meta name="dcterms.date" content="2022-06-26">

<title>Farid Musayev - Expected Threat Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Farid Musayev</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./p1.html">
 <span class="dropdown-text">Expected Goals Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./p3.html">
 <span class="dropdown-text">Scientific Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./p2.html">
 <span class="dropdown-text">Soccer Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./p4.html">
 <span class="dropdown-text">Text Mining Project</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#algorithm" id="toc-algorithm" class="nav-link" data-scroll-target="#algorithm">Algorithm</a>
  <ul class="collapse">
  <li><a href="#markov-chains-perspective" id="toc-markov-chains-perspective" class="nav-link" data-scroll-target="#markov-chains-perspective">Markov Chains Perspective</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#xg-model" id="toc-xg-model" class="nav-link" data-scroll-target="#xg-model">xG Model</a>
  <ul class="collapse">
  <li><a href="#shots-data" id="toc-shots-data" class="nav-link" data-scroll-target="#shots-data">Shots Data</a></li>
  <li><a href="#feature-generation" id="toc-feature-generation" class="nav-link" data-scroll-target="#feature-generation">Feature Generation</a></li>
  <li><a href="#model-training-with-logistic-regression" id="toc-model-training-with-logistic-regression" class="nav-link" data-scroll-target="#model-training-with-logistic-regression">Model Training with Logistic Regression</a></li>
  <li><a href="#model-performance-evaluation" id="toc-model-performance-evaluation" class="nav-link" data-scroll-target="#model-performance-evaluation">Model Performance Evaluation</a></li>
  </ul></li>
  <li><a href="#xt-equation-variables" id="toc-xt-equation-variables" class="nav-link" data-scroll-target="#xt-equation-variables">xT Equation Variables</a>
  <ul class="collapse">
  <li><a href="#probability-shooting-s_x-y" id="toc-probability-shooting-s_x-y" class="nav-link" data-scroll-target="#probability-shooting-s_x-y">Probability Shooting <span class="math inline">\(s_{x, y}\)</span></a></li>
  <li><a href="#probability-of-passing-m_x-y" id="toc-probability-of-passing-m_x-y" class="nav-link" data-scroll-target="#probability-of-passing-m_x-y">Probability of Passing <span class="math inline">\(m_{x, y}\)</span></a></li>
  <li><a href="#probability-of-scoring-xg_x-y" id="toc-probability-of-scoring-xg_x-y" class="nav-link" data-scroll-target="#probability-of-scoring-xg_x-y">Probability of Scoring <span class="math inline">\(xG_{x, y}\)</span></a></li>
  <li><a href="#transition-matrix-t_x-y" id="toc-transition-matrix-t_x-y" class="nav-link" data-scroll-target="#transition-matrix-t_x-y">Transition Matrix <span class="math inline">\(T_{x, y}\)</span></a></li>
  </ul></li>
  <li><a href="#xt-algorithm-implementation" id="toc-xt-algorithm-implementation" class="nav-link" data-scroll-target="#xt-algorithm-implementation">xT Algorithm Implementation</a></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">Results and Discussion</a>
  <ul class="collapse">
  <li><a href="#bundesliga" id="toc-bundesliga" class="nav-link" data-scroll-target="#bundesliga">Bundesliga</a></li>
  <li><a href="#epl" id="toc-epl" class="nav-link" data-scroll-target="#epl">EPL</a></li>
  <li><a href="#laliga" id="toc-laliga" class="nav-link" data-scroll-target="#laliga">LaLiga</a></li>
  <li><a href="#ligue-1" id="toc-ligue-1" class="nav-link" data-scroll-target="#ligue-1">Ligue 1</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#a1.-libraries" id="toc-a1.-libraries" class="nav-link" data-scroll-target="#a1.-libraries">A1. Libraries</a></li>
  <li><a href="#a2.-event-data-preprocessing" id="toc-a2.-event-data-preprocessing" class="nav-link" data-scroll-target="#a2.-event-data-preprocessing">A2. Event Data Preprocessing</a></li>
  <li><a href="#a3.-xg-model" id="toc-a3.-xg-model" class="nav-link" data-scroll-target="#a3.-xg-model">A3. xG Model</a></li>
  <li><a href="#a4.-xt-equation-variables-derivation" id="toc-a4.-xt-equation-variables-derivation" class="nav-link" data-scroll-target="#a4.-xt-equation-variables-derivation">A4. xT Equation Variables Derivation</a></li>
  <li><a href="#a5.-plot-functions" id="toc-a5.-plot-functions" class="nav-link" data-scroll-target="#a5.-plot-functions">A5. Plot Functions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Expected Threat Model</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
<p class="subtitle lead">The model was implemented in Python.</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Farid Musayev </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 26, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>The aim of this report is to build an Expected Threat (xT) Model and illustrate how it can be applied to evaluate performance of players that play from the deeper zones, mainly participate in the game build-up and can be overlooked by the traditional statistics like goals or assists or more advanced ones like Expected Goals (xG) or Expected Assists (xA).</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Goals and assists are traditional statistics in soccer which focus on player’s shooting and creative capabilities. They concentrate on the assessment of only goal-oriented skills of the player. However, there can be play sequences in soccer that do not end with shots and sometimes lack a final accurate pass or touch that could have put another player into a shooting position. In such circumstances, the evaluation of the game build-up is still important. The actions of players who generate these kind of situations on field should be quantifiable to understand the threatening degree of those situations, and see if a player could have made a better decision. Quantification of these actions can also help to assess impact of players who participate in the game build-up and do not often find themselves close to the opponent’s goal.</p>
<p>There are advanced metrics for the evaluation of players that participate in the game build-up such as <strong>xGChain</strong> and <strong>xGBuildup</strong>. However, the problem with these metrics is that the xG value of a resulting shot is divided equally among all participants involved in a play sequence (in case of xGBuildup, all players, except assisting and sh0oting ones, are included). These metrics also fail to capture non-shot ending game scenarios.</p>
<p>It is worth mentioning that there are also other well known models (Posession Value Framework, VAEP etc.) which can be used as alternatives to xT model and are widely implemented in soccer analytics today.</p>
<p>This report illustrates a simple implementation of xT model that accounts only for passes that increase team’s probability of scoring. Considering that each pass has an impact on team’s probability of scoring, we are able to evaluate how threatining is the pass and assign it a certain value.</p>
<p>This model was originally introduced by <a href="https://karun.in/blog/expected-threat.html">Karun Singh</a> in his blog post from 2019. Despite being written as a blog post, it gained a strong recognition from the soccer analytics community and was cited in different research papers. A grop of researchers from DTAI Sports Analytics Lab at KU Leuven University published a <a href="https://tomdecroos.github.io/reports/xt_vs_vaep.pdf">paper</a> where they were comparing xT Model to VAEP framework.</p>
</section>
<section id="algorithm" class="level2">
<h2 class="anchored" data-anchor-id="algorithm">Algorithm</h2>
<p>xT model represents a soccer pitch as a <code>12 x 16 grid</code> where each section of a grid has an assigned xT value. This value is defined as <code>a probability of a team scoring within n next actions</code>. When a player passes from <span class="math inline">\((x_{start}, y_{start})\)</span> to <span class="math inline">\((x_{end}, y_{end})\)</span> coordinate, a completed pass generates so called <code>xT difference</code> that allows to quantify its impact and understand how a team’s probability of scoring changes.</p>
<p>Below you can see xT grid that was calculated in the course of this report. Here, each zone of the grid contains a value that implies a team’s probability of scoring in <code>5</code> next actions. One may consider higher/lower number of actions but the important point is to observe convergence of xT values in the attacking area, and increasing probability the defending area. More actions would mean that a team can spend more time preparing an attack and gradually progressing further which results into a greater probability of scoring when starting from its own half.</p>
<div class="cell" data-execution_count="490">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>plot_xT()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-2-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>To calculate xT value for each coordinate (x, y) on the pitch, the following equation is used:</p>
<p><span class="math display">\[\begin{equation}
xT_{x,y} = s_{x,y}\cdot xG_{x,y} + m_{x, y} \cdot T_{x,y} \cdot xT
\end{equation}\]</span></p>
<p>where<br>
<span class="math inline">\(xT_{x,y}\)</span> - xT value for (x, y) coordinate</p>
<p><span class="math inline">\(s_{x,y}\)</span> - probability of shooting from (x, y) coordinate</p>
<p><span class="math inline">\(xG_{x,y}\)</span> - probability of scoring from (x, y) coordinate (expected goals value)</p>
<p><span class="math inline">\(m_{x, y}\)</span> - probability of passing from (x, y) coordinate</p>
<p><span class="math inline">\(T_{x, y}\)</span> - probability of passing from (x, y) coordinate to all other locations (transition matrix)</p>
<p><span class="math inline">\(xT\)</span> - matrix of xT values for all (x, y) coordinates</p>
<p>The intuition is that for a player located at (x, y) coordinate, there are two choices: shooting or passing. These are mutually exclusive events that have corresponding probabilities of occurrence. Given that a player shoots with <span class="math inline">\(s_{x, y}\)</span>, probability of scoring for that shot will be <span class="math inline">\(xG_{x, y}\)</span>. Given that player passes with <span class="math inline">\(m_{x, y}\)</span>, expected payoff from that pass will be <span class="math inline">\(T_{x, y} \cdot xT\)</span>. From (x, y) coordinate, a player has many options for passes, thus, different probabilities of passing to other areas (which are represented in the form of transition matrix <span class="math inline">\(T_{x,y}\)</span>). In addition, each of those passing choices would have their own reward in the form of <span class="math inline">\(xT\)</span> value. Thus, to calculate expected payoff of passing from (x, y), transition matrix from a given (x,y) is multiplied by a matrix of xT values of the whole pitch.</p>
<section id="markov-chains-perspective" class="level3">
<h3 class="anchored" data-anchor-id="markov-chains-perspective">Markov Chains Perspective</h3>
<p>We can view the above formula from the <a href="https://bayesball.github.io/BOOK/simulation-by-markov-chain-monte-carlo.html#markov-chains">Markov Chains Perspective</a> in the following way. Let us leave aside the left side of the formula and focus on the right side <span class="math inline">\(T_{x,y} \cdot xT\)</span>. Here, we observe <code>transition matrix</code> that stores transition probabilities for a player deciding to pass from (x, y) to all other locations on the grid. To evaluate the expected payoff of a completed pass from each (x,y), we also start with initial matrix of <code>xT values</code>.</p>
<p>As we know from the behavior of irreducible and aperiodic Markov Chains, as <code>transition matrix</code> is multiplied by itself infinite amount of times and some <code>initial starting state</code>, one can observe convergence to the <code>stationary distribution</code>. This actually illustrates that it does not matter what is that initial starting state. In the above formula, we view our matrix of <code>xT values</code> as an initial starting state of all <code>0</code> values and iteratively multiply it by transition matrix.</p>
<p>In our specific case, as the number of iterations increase, one can observe convergence of xT values in more threating zones and increasing probability mass in less threatening zones. A number of iterations equals a number of subsequent actions after which a team scores a goal. This explains why a probability mass increases in less threatening zones (in the own half of the team in possesion) since more actions mean more time for abuild-up and preparation of an attack from the own half of a team in possession.</p>
</section>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p><a href="https://figshare.com/collections/Soccer_match_event_dataset/4415000/2">Wyscout Soccer Match Event dataset</a> from 2017/2018 English Premier League (EPL) is used to build xT model.</p>
<div class="cell" data-scrolled="true" data-execution_count="458">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wyscout_data.competitions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="458">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>competition_id</th>
      <th>season_id</th>
      <th>country_name</th>
      <th>competition_name</th>
      <th>competition_gender</th>
      <th>season_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>524</td>
      <td>181248</td>
      <td>Italy</td>
      <td>Italian first division</td>
      <td>male</td>
      <td>2017/2018</td>
    </tr>
    <tr>
      <th>1</th>
      <td>364</td>
      <td>181150</td>
      <td>England</td>
      <td>English first division</td>
      <td>male</td>
      <td>2017/2018</td>
    </tr>
    <tr>
      <th>2</th>
      <td>795</td>
      <td>181144</td>
      <td>Spain</td>
      <td>Spanish first division</td>
      <td>male</td>
      <td>2017/2018</td>
    </tr>
    <tr>
      <th>3</th>
      <td>412</td>
      <td>181189</td>
      <td>France</td>
      <td>French first division</td>
      <td>male</td>
      <td>2017/2018</td>
    </tr>
    <tr>
      <th>4</th>
      <td>426</td>
      <td>181137</td>
      <td>Germany</td>
      <td>German first division</td>
      <td>male</td>
      <td>2017/2018</td>
    </tr>
    <tr>
      <th>5</th>
      <td>102</td>
      <td>9291</td>
      <td>International</td>
      <td>European Championship</td>
      <td>male</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>6</th>
      <td>28</td>
      <td>10078</td>
      <td>International</td>
      <td>World Cup</td>
      <td>male</td>
      <td>2018</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Specifically, match event dataset is used to evaluate <span class="math inline">\(xG_{x, y}\)</span>, <span class="math inline">\(s_{x, y}\)</span>, <span class="math inline">\(m_{x, y}\)</span> and <span class="math inline">\(T_{x, y}\)</span> (see next sections).<br>
See Appendix section <strong>A2. Event Data Preprocessing</strong> for full code on data preparation.</p>
</section>
<section id="xg-model" class="level2">
<h2 class="anchored" data-anchor-id="xg-model">xG Model</h2>
<p>This section illustrates a methodology for implementing xG model that is used to evaluate <span class="math inline">\(xG_{x, y}\)</span> for a given (x, y) coordinate on the pitch.</p>
<section id="shots-data" class="level3">
<h3 class="anchored" data-anchor-id="shots-data">Shots Data</h3>
<p>After data preprocessing steps, we filter out all 7134 shots for EPL 2017/2018 season (see <strong>A3.1 Filter Shots</strong>).</p>
<div class="cell" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>shots.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>player_id</th>
      <th>type_id</th>
      <th>type_name</th>
      <th>subtype_id</th>
      <th>subtype_name</th>
      <th>tag_id</th>
      <th>tag_name</th>
      <th>x_start</th>
      <th>y_start</th>
      <th>x_end</th>
      <th>y_end</th>
      <th>outcome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25413</td>
      <td>10</td>
      <td>shot</td>
      <td>100</td>
      <td>shot</td>
      <td>[101, 402, 201, 1205, 1801]</td>
      <td>['goal', 'right foot', 'opportunity', 'positio...</td>
      <td>88</td>
      <td>41</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>26150</td>
      <td>10</td>
      <td>shot</td>
      <td>100</td>
      <td>shot</td>
      <td>[401, 201, 1211, 1802]</td>
      <td>['left foot', 'opportunity', 'position: out ce...</td>
      <td>85</td>
      <td>52</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7868</td>
      <td>10</td>
      <td>shot</td>
      <td>100</td>
      <td>shot</td>
      <td>[401, 201, 1215, 1802]</td>
      <td>['left foot', 'opportunity', 'position: out hi...</td>
      <td>81</td>
      <td>33</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7868</td>
      <td>10</td>
      <td>shot</td>
      <td>100</td>
      <td>shot</td>
      <td>[402, 201, 1205, 1801]</td>
      <td>['right foot', 'opportunity', 'position: goal ...</td>
      <td>75</td>
      <td>30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7945</td>
      <td>10</td>
      <td>shot</td>
      <td>100</td>
      <td>shot</td>
      <td>[401, 2101, 1802]</td>
      <td>['left foot', 'blocked', 'not accurate']</td>
      <td>90</td>
      <td>39</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (number of shots, number of features)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>shots.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(7134, 12)</code></pre>
</div>
</div>
</section>
<section id="feature-generation" class="level3">
<h3 class="anchored" data-anchor-id="feature-generation">Feature Generation</h3>
<p>To calculate <code>xG</code> model, we have to create two features <code>distance to goal</code> and <code>angle of shot</code> (see also <strong>A3.2 Feature Generating Function</strong>).</p>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance Feature calculation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define goal center for 'wyscout' data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>goal_center <span class="op">=</span> np.array([<span class="dv">100</span>, <span class="dv">50</span>])</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between shot and goal center</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'distance'</span>] <span class="op">=</span> np.sqrt((shots[<span class="st">'x_start'</span>] <span class="op">-</span> goal_center[<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (shots[<span class="st">'y_start'</span>] <span class="op">-</span> goal_center[<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'distance'</span>] <span class="op">=</span> shots[<span class="st">'distance'</span>].<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Angle Feature calculation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform x, y coordinates from percentiles to field length coordinates (105 meters x 68 meters)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> shots[<span class="st">'x_start'</span>] <span class="op">*</span> <span class="dv">105</span><span class="op">/</span><span class="dv">100</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shots[<span class="st">'y_start'</span>] <span class="op">*</span> <span class="dv">68</span><span class="op">/</span><span class="dv">100</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use trigonometric formula to find angle between two sides (a,b ) of triangle where third side (c) </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># is a goal line of length 7.32 m</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">30.34</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between right post and (x,y) shot coordinate</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">37.66</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between left post and (x,y) shot coordinate</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">7.32</span> <span class="co"># goal line length</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>cos_alpha <span class="op">=</span> (a<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> c<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>a<span class="op">*</span>b)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>cos_alpha <span class="op">=</span> np.<span class="bu">round</span>(cos_alpha, decimals <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># remember to leave angle in radians (if you want to transfer to degree multiply cos_alpha by 180/pi)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'angle'</span>] <span class="op">=</span> np.arccos(cos_alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-training-with-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="model-training-with-logistic-regression">Model Training with Logistic Regression</h3>
<p>Then, we use Logistic Regression to fit our data and create xG model.</p>
<div class="cell" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare features and labels from available data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> shots[[<span class="st">'distance'</span>, <span class="st">'angle'</span>]]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> shots[<span class="st">'outcome'</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Logistic Regression Model</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>xG_model <span class="op">=</span> LogisticRegression()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>xG_model.fit(features, labels)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># save predictions</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> xG_model.predict_proba(features)[:, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below is a plot of a number of shots versus predictions. This allows to see that only a small fraction of shots has a high probability of scoring which makes sense.</p>
<div class="cell" data-execution_count="579">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plot_predictions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="model-performance-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-evaluation">Model Performance Evaluation</h3>
<p>Model performance evaluation is implemented using ROC curve (for details see <strong>A3.3 xG Model Evaluation with ROC</strong>).</p>
<div class="cell" data-execution_count="471">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plot_roc()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate area under ROC curve using Python function roc_auc_score()</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>roc_auc_score(ndf[<span class="st">'outcome'</span>], ndf[<span class="st">'xG'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>0.7843416803145005</code></pre>
</div>
</div>
<p>We see that ROC value <code>0.784</code> is well above random guess (&gt;&gt; 0.5) which is an indicator of a satisfactory model performance.</p>
</section>
</section>
<section id="xt-equation-variables" class="level2">
<h2 class="anchored" data-anchor-id="xt-equation-variables">xT Equation Variables</h2>
<p>In section 3, xT equation variables <span class="math inline">\(s_{x, y}\)</span>, <span class="math inline">\(m_{x, y}\)</span>, <span class="math inline">\(xG_{x, y}\)</span> were defined. Below you can see obtained results for each of these variables (see <strong>A4. xT Equation Variables Derivation</strong>).</p>
<p>All of the results were obtained in the form of 12x16 matrix which was illustrated as a pitch heatmap.</p>
<section id="probability-shooting-s_x-y" class="level3">
<h3 class="anchored" data-anchor-id="probability-shooting-s_x-y">Probability Shooting <span class="math inline">\(s_{x, y}\)</span></h3>
<p>This heatmap illustrates probability of shooting <span class="math inline">\(s_{x, y}\)</span> from a given (x, y). Naturally, as a player approaches an opponent’s goal, <span class="math inline">\(s_{x, y}\)</span> increases.</p>
<div class="cell" data-execution_count="495">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plot_shot_probs()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-12-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="probability-of-passing-m_x-y" class="level3">
<h3 class="anchored" data-anchor-id="probability-of-passing-m_x-y">Probability of Passing <span class="math inline">\(m_{x, y}\)</span></h3>
<p>This heatmap illustrates probability of passing <span class="math inline">\(m_{x, y}\)</span> from a given (x, y). Naturally, as a player approaches an opponent’s goal, <span class="math inline">\(m_{x, y}\)</span> decreases, since a player becomes more inclined to shooting.</p>
<div class="cell" data-execution_count="484">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_pass_probs()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-13-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="probability-of-scoring-xg_x-y" class="level3">
<h3 class="anchored" data-anchor-id="probability-of-scoring-xg_x-y">Probability of Scoring <span class="math inline">\(xG_{x, y}\)</span></h3>
<p>This heatmap illustrates probability of scoring <span class="math inline">\(xG_{x, y}\)</span> from a given (x, y). Naturally, as a player approaches an opponent’s goal, the distance to a goal decreases and the angle of a shot increases, thus, <span class="math inline">\(xG_{x, y}\)</span> increases.</p>
<div class="cell" data-execution_count="488">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plot_score_probs()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-14-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="transition-matrix-t_x-y" class="level3">
<h3 class="anchored" data-anchor-id="transition-matrix-t_x-y">Transition Matrix <span class="math inline">\(T_{x, y}\)</span></h3>
<p>Below you can see a function <code>transition_matrix()</code>that for a given (x, y) coordinate calculates a probability of passing to all other (x, y) coordinates (transition probabilities) and stores them inside a matrix.</p>
<div class="cell" data-execution_count="496">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transition_matrix(x, y):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># empty matrix for storing transition probabilities</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># from passes data frame filter out only passes with initial (x, y) equal to a given (x, y)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    transition_passes <span class="op">=</span> passes[(passes[<span class="st">"x_start_bin"</span>] <span class="op">==</span> x) <span class="op">&amp;</span> (passes[<span class="st">"y_start_bin"</span>] <span class="op">==</span> y)]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># iterate over all filtered passes and count passes with equal (x, y)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(transition_passes.shape[<span class="dv">0</span>]):</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        row_ind <span class="op">=</span> transition_passes[<span class="st">"y_end_bin"</span>].iloc[i]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        col_ind <span class="op">=</span> transition_passes[<span class="st">"x_end_bin"</span>].iloc[i]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        transition_matrix[row_ind, col_ind] <span class="op">=</span> transition_matrix[row_ind, col_ind] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># divide counts for each (x, y) by the total number of passes to calculate probabilities</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> transition_matrix<span class="op">/</span>transition_passes.shape[<span class="dv">0</span>]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="xt-algorithm-implementation" class="level2">
<h2 class="anchored" data-anchor-id="xt-algorithm-implementation">xT Algorithm Implementation</h2>
<p>Finally, using all the above estimated probabilities we can evaluate our xT values for all (x, y) coordinates of the pitch.</p>
<div class="cell" data-scrolled="true" data-execution_count="192">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># xT algorithm</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>xT <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 iterations</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">16</span>):</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># evaluate transition matrix for a given (x, y)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            T_matrix <span class="op">=</span> transition_matrix(x, y)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="co"># evaluate xT value for a given (x, y) using equation from section 3</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            xT[y, x] <span class="op">=</span> shot_probs[y, x] <span class="op">*</span> score_probs[y, x] <span class="op">+</span> pass_probs[y, x] <span class="op">*</span> np.<span class="bu">sum</span>(T_matrix <span class="op">*</span> xT)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># round and save results</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>it5 <span class="op">=</span> pd.DataFrame(xT).<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#it5.to_csv('xT_grid.csv', index = False)    </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="491">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plot_xT()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-17-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="results-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="results-and-discussion">Results and Discussion</h2>
<p>We make a sanity check of our model by comparing and plotting xT values of the players across <strong>Bundesliga, EPL, LaLiga and Ligue 1</strong> from 2017/2018 season using <a href="https://figshare.com/collections/Soccer_match_event_dataset/4415000/2">Wyscout Soccer Match Event Dataset</a>.</p>
<p>Barplots on the left illustrate xT values of top 10 players in the league. Barplots on the right illustrate xT values of top 10 young players among all league players aged under 21. Since the data is from 2017/2018 season, this allows us to track how the careers of young players actually developed given a single successful (according to xT) season.</p>
<p>See <strong>A5. Plot Functions</strong> for the code for all plots in the following sections.</p>
<section id="bundesliga" class="level3">
<h3 class="anchored" data-anchor-id="bundesliga">Bundesliga</h3>
<p>For Bundesliga, top 10 performers are mainly midfielders and defenders. Thiago Alcantara is well known as one of the most technically gifted players in the european football. He plays as the central midfielder, and, naturally, does not register a high number of goals and assists (2 league goals and 2 assists in 2017/2018) in his statistics. Nevertheless, he is the top performer in terms of xT per 90 equal to 0.56 according to our model (which means that, on average, his passes increase his team’s probability of scoring by 0.56 per game). It makes sense to see Alcantara in the top 10 of our bar graph, since he is well known for a high ability to control the game in the central area and initiate attacks with line-breaking passes (the ones that may cut through and leave behind several players of opponent’s team). There are also players similar to Alcantara’s profile such as Nuri Sahin (2 goals, 2 assists), Charles Aranguiz (1 goal, 3 assists) who also found their place in our top 10.</p>
<p>Central defenders also have a dominant presence in our xT bar graph. Given that they spend a large amount of time on field, in some scenarios, this can lead to a high number of aggregated small xT values. Thus, it is always important to normalize values per a single game ( per 90 minutes). Apart from that, modern central defenders should be capable of initiating their team’s attacks with a great first pass (line-breaking pass, switch etc.). Players like Jerome Boateng and Mats Hummels are, in particular, appreciated for this kind of passes.</p>
<p>As stated previously, we can assess xT performance of young players and basing on a sinlge season success track their further career development. For example, Dayot Upamecano had a first breakthrough season in RB Leipzig (top of our xT bar graph) and after three more years of a consistent performance moved to Bayern Munich. During 2017/2018, Kai Havertz was already having his second full season in a senior football being 19 years old. He had two more successful seasons (29 goals, 9 assists) in Bayern Leverkusen and, then, moved to Chelsea. Panagiotis Retsos had a breakthrough season at Bayern Leverkusen as a right full back but suffered three serious injuries which kept him out of the game for the majority of the next season. This obivously had a serious impact on his career, and, so far, he struggled to regain his form during loan spells in England, France and Italy.</p>
<div class="cell" data-execution_count="587">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plot_bundesliga()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-18-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="epl" class="level3">
<h3 class="anchored" data-anchor-id="epl">EPL</h3>
<p>In contrast with Bundesliga, top 10 EPL performers are mainly central and attacking midfielders and even a single wide playing forward. Starting from the latter, this is Alexis Sanchez, who made 74 shot creating passes in 2017/2018. In particular, he was also vital to his team for the ability to drop back into midfield and participate in the initiation of attacks.</p>
<p>The rest of top five (Cesc Fabregas, Kevin De Bruyne, Mesut Ozil, David Silva) are creative forces of their teams (0.70, 0.59, 0.57, 0.54 xT per 90). All four were generating the chances of at least a half goal per a game, and this does not even include the rest of their advaced statistics such as xG or xA. The bottom top five consists of more functional central midfielders (except attacking Phillipe Coutinho) whose xT values are close or slightly higher that 0.5. In other words, we observe that xT metric validates importance of these players for their teams.</p>
<p>When having a look at the performance of young players, we can observe a rise of full backs such as Trent Alexander-Arnold, Ainsley Maitland-Niles, Timothy Fosu-Mensah and Ben Chilwell. Alexander-Arnold (0.32 xT per 90) is regarded one of the top performing full backs of the last three seasons (9 goals, 44 assists). He is known for his ability to initiate the attacks from the right half-space. As with senior players, we observe functional midfielders such as Wilfred Ndidi and Declan Rice in the bottom five of our bar graph. Being recognized for their defensive skills, these players are regular starters of their teams despite their young age.</p>
<div class="cell" data-execution_count="599">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plot_epl()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-19-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="laliga" class="level3">
<h3 class="anchored" data-anchor-id="laliga">LaLiga</h3>
<p>Similar to EPL, we mainly observe central and attacking midfielders among top 10 performers in LaLiga. However, one name stands out here, and that is Lionel Messi. Messi is known for his skills to drop deeper, participate in the game play in the central area and, then, run forward. This is one of the reasons why he managed to aggregate 0.59 xT per 90. Andres Iniesta and Ever Banega also have identical to Messi’s xT results and are an essential part of their teams during the possession. It is also interesting to see a left full back Marcelo with his 0.5 xT per 90. Though mainly playing from the left, he possess great passing skills which help to build and progress his team’s attacks.</p>
<p>LaLiga’s top young players play in various positions from wingers and central midfielders to full backs and central defenders. Despite being largerly hit by injuries, Ousmane Dembele were able to demonstrate his potential with 0.28 xT per 90 in his first season for Barcelona. However, injuries still haunted him in the following seasons which, obviously, affected his career. Theo Hernandez impressed for Real Madrid as a left full back (0.22 xT per 90), despite a limited time, and, in the last three seasons, were a stable starting eleven player for Milan. Federico Valverde had a great season as a box-to-box midfielder (0.25 xT per 90) in his first season for Deportivo La Coruna, and, afterwards, earned his place in Real Madrid.</p>
<div class="cell" data-execution_count="600">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plot_laliga()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-20-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ligue-1" class="level3">
<h3 class="anchored" data-anchor-id="ligue-1">Ligue 1</h3>
<p>When evaluating top 10 players from Ligue 1, we observe similar patterns as in LaLiga. The first place is reserved by Neymar with 0.62 xT per 90 who plays as a wide forward or attacking midfielder. There are also several deep-lying midfielders such as Marco Veratti, Yann M’vila, Thiago Motta and Jean Seri. Similar to Marcelo from LaLiga, Daniel Alves is the only full back in the list. Daniel Alves who operates from the right wing has always been a creative and technical player with great passing and ball progressing skills. In any of the teams in which he played, he has been instrumental to holding possession and movement of a ball to high threating areas.</p>
<p>Maxime Lopez is the only player, out of four leagues that were reviewed, who earned his place in both senior and young players list with 0.51 xT per 90. Despite his young age of 19, 2017/2018 season was already his second season in senior football where he helped Marseille to achieve the fourth place in the league. He continued playing as a midfielder three more years for the french club but had a limited time in the last season. Thus, he was loaned to the italian team Sassuolo. Despite playing regularly there, he could not convince Marseille to bring him back and, eventually, stayed in Italy on the permanent basis.</p>
<div class="cell" data-execution_count="601">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plot_ligue1()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="report_files/figure-html/cell-21-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>As it can be seen from the above results, xT Model demonstrates a good performance when trying to evaluate players who are overlooked by traditional or shot-oriented advanced statistics but are still important to their teams. These can be different types of players such as central defenders with a great first pass, deep-lying midfielders switching game with long ranging passes and creative full backs involved in possession. However, as it stands for all models, this model also has a room for improvement.</p>
<p>Below are suggestions for further studies of xT model: - add other action types such as carries and take-ons - account for actions with negative xT such as inaccurate passes or lost balls - use negative xT during player performance evaluation - normalize xT results per number of actions by a player</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p><em><a href="https://karun.in/blog/expected-threat.html">Karun Singh’s</a> Expected Threat Model, 2019.</em></p></li>
<li><p><em>Roy, Maaike Van, Pieter Robberechts, Tom Decroos and Jesse Davis. <a href="https://tomdecroos.github.io/reports/xt_vs_vaep.pdf">“Valuing On-the-Ball Actions in Soccer: A Critical Comparison of xT and VAEP.”</a> (2020).</em></p></li>
<li><p><em>Jim Albert and Jingchen Hu, <a href="https://bayesball.github.io/BOOK/simulation-by-markov-chain-monte-carlo.html#markov-chains">Probability and Bayesian Modelling</a>, Ch. 9.2, Markov Chains, 2019.</em></p></li>
<li><p><em><a href="https://figshare.com/collections/Soccer_match_event_dataset/4415000/2">Wyscout Soccer Match Event Dataset</a>, 2019.</em></p></li>
</ul>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<section id="a1.-libraries" class="level3">
<h3 class="anchored" data-anchor-id="a1.-libraries">A1. Libraries</h3>
<div class="cell" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import required libraries</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mplsoccer <span class="im">import</span> Pitch, VerticalPitch</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib_inline</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a2.-event-data-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="a2.-event-data-preprocessing">A2. Event Data Preprocessing</h3>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import public wyscout data loader from socceraction library</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> socceraction.data.wyscout <span class="im">import</span> PublicWyscoutLoader </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load public wyscout data</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>wyscout_data <span class="op">=</span> PublicWyscoutLoader()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import tags for uncode subevents in event data</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> pd.read_csv(<span class="st">'wyscout_tags.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make all descriptions lowercase</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>tags[<span class="st">'Description'</span>] <span class="op">=</span> tags[<span class="st">'Description'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># transform tags data frame into dictionary</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(tags[<span class="st">'Tag'</span>], tags[<span class="st">'Description'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># England 17/18, competition_id = 364, season_id = 181150</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>epl_games <span class="op">=</span> wyscout_data.games(competition_id <span class="op">=</span> <span class="dv">364</span>, season_id <span class="op">=</span> <span class="dv">181150</span>)[<span class="st">"game_id"</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">##################################################################################################</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Below sections were executed a single time and saved as .csv files (only comment out if needed)#</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">##################################################################################################</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Section 1.</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># convert all premier league matches to SPADL format and save as .csv files</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in epl_games:</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    df = wyscout_data.events(i)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    df.to_csv(f'epl_games/{i}.csv')</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">###################################################################################################</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Section 2.</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># concate all .csv files aka 'game ids' into a single data frame and save events.csv</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># list of all game ids</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#files = os.listdir('epl_games/.')</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#events = pd.DataFrame()</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in files:</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    df = pd.read_csv(f'epl_games/{i}')</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#    events = pd.concat([events, df])</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#events.to_csv(f'events.csv', index = False)    </span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">## This code refines all events for the specific task</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co"># upload 'events' data frame that includes events of all 380 EPL games</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'events.csv'</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># create column indices to be removed</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>rm_col_ind <span class="op">=</span> np.r_[<span class="dv">0</span>:<span class="dv">6</span>]</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns <span class="op">=</span> df.columns[rm_col_ind])</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co"># convert strings into python lists</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tags'</span>] <span class="op">=</span> df[<span class="st">'tags'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'positions'</span>] <span class="op">=</span> df[<span class="st">'positions'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># make 'type_name' and 'subtype_name' columns lowercase </span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'type_name'</span>] <span class="op">=</span> df[<span class="st">'type_name'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'subtype_name'</span>] <span class="op">=</span> df[<span class="st">'subtype_name'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># create separate initial(start) and final(end) coordinates from 'positions' column</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co"># if action has only 'start' coordinates set 'end' coordinates to 'nan'</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'x_start'</span>] <span class="op">=</span> df[<span class="st">'positions'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>][<span class="st">'x'</span>])</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y_start'</span>] <span class="op">=</span> df[<span class="st">'positions'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>][<span class="st">'y'</span>])</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'x_end'</span>] <span class="op">=</span> df[<span class="st">'positions'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">1</span>][<span class="st">'x'</span>] <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">2</span> <span class="cf">else</span> np.nan)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y_end'</span>] <span class="op">=</span> df[<span class="st">'positions'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">1</span>][<span class="st">'y'</span>] <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">2</span>  <span class="cf">else</span> np.nan)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co"># use dictionaries and list comprehensions to convert tags into tag ids and their descriptions </span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_id'</span>] <span class="op">=</span> df[<span class="st">'tags'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: [value <span class="cf">for</span> d <span class="kw">in</span> x <span class="cf">for</span> value <span class="kw">in</span> d.values()])</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_name'</span>] <span class="op">=</span> df[<span class="st">'tag_id'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: [tags[i] <span class="cf">for</span> i <span class="kw">in</span> x])</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="co"># drop redundant column 'positions'</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>df.drop(columns <span class="op">=</span> [<span class="st">'positions'</span>, <span class="st">'tags'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange columns</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>rearr_cols <span class="op">=</span> np.r_[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">5</span>:<span class="dv">9</span>]</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.iloc[:, rearr_cols]</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co"># save 'df' as 'refined_events.csv' data frame</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'refined_events.csv'</span>, index <span class="op">=</span> <span class="va">False</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a3.-xg-model" class="level3">
<h3 class="anchored" data-anchor-id="a3.-xg-model">A3. xG Model</h3>
<section id="a3.1-filter-shots" class="level4">
<h4 class="anchored" data-anchor-id="a3.1-filter-shots">A3.1 Filter Shots</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'epl/refined_events.csv'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_id'</span>] <span class="op">=</span> df[<span class="st">'tag_id'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_name'</span>] <span class="op">=</span> df[<span class="st">'tag_name'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># free kicks are not included (penalties are also part of free kicks)</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> df[df[<span class="st">'type_name'</span>] <span class="op">==</span> <span class="st">'shot'</span>]</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># function for removing headers</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> headers_out(x):</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> x:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">403</span>:</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># function for assigning shot outcomes as '1' or '0' (goal or no goal)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> goals(x):</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> x:</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">101</span>:</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co"># remove headers from shots</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>non_headers <span class="op">=</span> shots[<span class="st">'tag_id'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: headers_out(x))</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> shots[non_headers]</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co"># assign outcome to each shot</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> shots[<span class="st">'tag_id'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: goals(x))</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'outcome'</span>] <span class="op">=</span> outcome</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>shots.to_csv(<span class="st">'epl/shots.csv'</span>, index <span class="op">=</span> <span class="va">False</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> pd.read_csv(<span class="st">'epl/shots.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a3.2-feature-generating-function" class="level4">
<h4 class="anchored" data-anchor-id="a3.2-feature-generating-function">A3.2 Feature Generating Function</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 'Angle' and 'Distance' features from x,y coordinates provided as a new input to our xG model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_features(coords):</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unpack tuple</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> coords[<span class="dv">0</span>]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> coords[<span class="dv">1</span>]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Distance Feature calculation</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># define goal center for 'wyscout' data</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    goal_center <span class="op">=</span> np.array([<span class="dv">100</span>, <span class="dv">50</span>])</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate distance between shot and goal center</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    distance <span class="op">=</span> np.sqrt((x <span class="op">-</span> goal_center[<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> goal_center[<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    distance <span class="op">=</span> distance.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Angle Feature calculation</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform x, y coordinates from percentiles to field length coordinates (105 meters x 68 meters)</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">*</span> <span class="dv">105</span><span class="op">/</span><span class="dv">100</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y <span class="op">*</span> <span class="dv">68</span><span class="op">/</span><span class="dv">100</span> </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use trigonometric formula to find angle between two sides (a,b ) of triangle where third side c is a goal line of length 7.32</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">30.34</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between right post and x,y shot coordinate</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">37.66</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between left post and x,y shot coordinate</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fl">7.32</span> <span class="co"># goal line length</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    cos_alpha <span class="op">=</span> (a<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> c<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>a<span class="op">*</span>b)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    cos_alpha <span class="op">=</span> np.<span class="bu">round</span>(cos_alpha, decimals <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remember to leave angle in radians (if you want to transfer to degree multiply cos_alpha by 180/pi)</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    angle <span class="op">=</span> np.arccos(cos_alpha).<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return 'distance' and 'angle' features as numpy array</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([distance, angle])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a3.3-xg-model-evaluation-with-roc" class="level4">
<h4 class="anchored" data-anchor-id="a3.3-xg-model-evaluation-with-roc">A3.3 xG Model Evaluation with ROC</h4>
<div class="cell" data-execution_count="578">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_predictions():</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize <span class="op">=</span> (<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    plt.plot(<span class="bu">sorted</span>(predictions))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'number of shots'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'probabiliy of scoring'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ndf <span class="op">=</span> pd.concat([features, labels], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ndf <span class="op">=</span> ndf.reset_index()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ndf.drop(<span class="st">"index"</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ndf[<span class="st">"xG"</span>] <span class="op">=</span> xG_model.predict_proba(features)[:, <span class="dv">1</span>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># define range for threshold value</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create row for checking each value with 'r' threshold values</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>ndf[<span class="st">'sim_outcome'</span>] <span class="op">=</span> np.zeros(shape <span class="op">=</span> (ndf.shape[<span class="dv">0</span>], <span class="dv">1</span>))</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create container matrix for FPR and TPR</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>roc_matrix <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">100</span>, <span class="dv">3</span>))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 'r' threshold values for probability </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>thresholds <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span>n)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># save threshold values as the first row</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>roc_matrix[:, <span class="dv">0</span>] <span class="op">=</span> thresholds</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, m <span class="kw">in</span> <span class="bu">enumerate</span>(thresholds):</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    ndf[<span class="st">'sim_outcome'</span>] <span class="op">=</span> ndf[<span class="st">'xG'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">&gt;</span> m <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    TN, FP, FN, TP <span class="op">=</span> confusion_matrix(ndf[<span class="st">'outcome'</span>], ndf[<span class="st">'sim_outcome'</span>]).ravel()</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    roc_matrix[i, <span class="dv">1</span>] <span class="op">=</span> FP<span class="op">/</span>(TN <span class="op">+</span> FP) <span class="co"># false positive rate</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    roc_matrix[i, <span class="dv">2</span>] <span class="op">=</span> TP<span class="op">/</span>(TP <span class="op">+</span> FN) <span class="co"># true positive rate</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot ROC curve</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_roc():</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    ax.grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.4</span>, which <span class="op">=</span> <span class="st">'major'</span>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    ax.plot(roc_matrix[:, <span class="dv">1</span>], roc_matrix[:, <span class="dv">2</span>], zorder <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    ax.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], ls <span class="op">=</span> <span class="st">'--'</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"false positive rate"</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"true positive rate"</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    ax.legend(labels <span class="op">=</span> [<span class="st">'xG Model'</span>, <span class="st">'Random Guess'</span>], loc <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>              <span class="co">#bbox_to_anchor=(1.0, 0.1, 0.5, 0.5),</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>             frameon <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="a4.-xt-equation-variables-derivation" class="level3">
<h3 class="anchored" data-anchor-id="a4.-xt-equation-variables-derivation">A4. xT Equation Variables Derivation</h3>
<section id="a4.1-shooting-probability" class="level4">
<h4 class="anchored" data-anchor-id="a4.1-shooting-probability">A4.1 Shooting Probability</h4>
<div class="cell" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x_intervals <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">17</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>y_intervals <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">13</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"x_start_bin"</span>] <span class="op">=</span> pd.cut(shots[<span class="st">"x_start"</span>], bins <span class="op">=</span> x_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"y_start_bin"</span>] <span class="op">=</span> pd.cut(shots[<span class="st">"y_start"</span>], bins <span class="op">=</span> y_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"x_end_bin"</span>] <span class="op">=</span> pd.cut(shots[<span class="st">"x_end"</span>], bins <span class="op">=</span> x_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"y_end_bin"</span>] <span class="op">=</span> pd.cut(shots[<span class="st">"y_end"</span>], bins <span class="op">=</span> y_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>shot_counts <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shots.shape[<span class="dv">0</span>]):</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    row_ind <span class="op">=</span> shots[<span class="st">"y_start_bin"</span>].iloc[i]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    col_ind <span class="op">=</span> shots[<span class="st">"x_start_bin"</span>].iloc[i]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    shot_counts[row_ind, col_ind] <span class="op">=</span> shot_counts[row_ind, col_ind] <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a4.2-passing-probability" class="level4">
<h4 class="anchored" data-anchor-id="a4.2-passing-probability">A4.2 Passing Probability</h4>
<div class="cell" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'epl/refined_events.csv'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_id'</span>] <span class="op">=</span> df[<span class="st">'tag_id'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tag_name'</span>] <span class="op">=</span> df[<span class="st">'tag_name'</span>].<span class="bu">apply</span>(ast.literal_eval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># free kicks are not included (penalties are also part of free kicks)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>passes <span class="op">=</span> df[df[<span class="st">'type_name'</span>] <span class="op">==</span> <span class="st">'pass'</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>passes[<span class="st">"x_start_bin"</span>] <span class="op">=</span> pd.cut(passes[<span class="st">"x_start"</span>], bins <span class="op">=</span> x_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>passes[<span class="st">"y_start_bin"</span>] <span class="op">=</span> pd.cut(passes[<span class="st">"y_start"</span>], bins <span class="op">=</span> y_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>passes[<span class="st">"x_end_bin"</span>] <span class="op">=</span> pd.cut(passes[<span class="st">"x_end"</span>], bins <span class="op">=</span> x_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>passes[<span class="st">"y_end_bin"</span>] <span class="op">=</span> pd.cut(passes[<span class="st">"y_end"</span>], bins <span class="op">=</span> y_intervals, include_lowest<span class="op">=</span><span class="va">True</span>, labels <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># save accurate passes as .csv file</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>passes.to_csv(<span class="st">'epl_passes.csv'</span>, index <span class="op">=</span> <span class="va">False</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="68">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>passes <span class="op">=</span> pd.read_csv(<span class="st">'epl/epl_passes.csv'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>pass_counts <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(passes.shape[<span class="dv">0</span>]):</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    row_ind <span class="op">=</span> passes[<span class="st">"y_start_bin"</span>].iloc[i]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    col_ind <span class="op">=</span> passes[<span class="st">"x_start_bin"</span>].iloc[i]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    pass_counts[row_ind, col_ind] <span class="op">=</span> pass_counts[row_ind, col_ind] <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pass probabilities</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pass_probs <span class="op">=</span> pass_counts<span class="op">/</span>(pass_counts <span class="op">+</span> shot_counts)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># shot probabilities</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>shot_probs <span class="op">=</span> shot_counts<span class="op">/</span>(pass_counts <span class="op">+</span> shot_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a4.3-scoring-probability" class="level4">
<h4 class="anchored" data-anchor-id="a4.3-scoring-probability">A4.3 Scoring Probability</h4>
<div class="cell" data-execution_count="74">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">160</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>y_grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">120</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scoring probability for </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>xG_values <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">120</span>, <span class="dv">160</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(x_grid)):</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(y_grid)):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(i, j)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> x_grid[i], y_grid[j]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> generate_features(k)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        xG_values[j, i] <span class="op">=</span> xG_model.predict_proba(f1.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))[:, <span class="dv">1</span>]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 x 16 grid without averaging</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>unrefined_xg <span class="op">=</span> pd.DataFrame(xG_values)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>refined_xg <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>x_len <span class="op">=</span> xG_values.shape[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>y_len <span class="op">=</span> xG_values.shape[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>row_ind <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, y_len, <span class="dv">10</span>):</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    col_ind <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, x_len, <span class="dv">10</span>):</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        avg_result <span class="op">=</span> unrefined_xg.iloc[(j <span class="op">-</span> <span class="dv">10</span>):j, (i <span class="op">-</span> <span class="dv">10</span>):i].values.mean()</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        refined_xg[row_ind, col_ind] <span class="op">=</span> avg_result</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        col_ind <span class="op">=</span> col_ind <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    row_ind <span class="op">=</span> row_ind <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="co"># scoring probabilities derived from xG model</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>score_probs <span class="op">=</span> refined_xg.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="a5.-plot-functions" class="level3">
<h3 class="anchored" data-anchor-id="a5.-plot-functions">A5. Plot Functions</h3>
<section id="a5.1-xt-values-grid" class="level4">
<h4 class="anchored" data-anchor-id="a5.1-xt-values-grid">A5.1 xT values Grid</h4>
<div class="cell" data-execution_count="489">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>matplotlib_inline.backend_inline.set_matplotlib_formats(<span class="st">'svg'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_xT():</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import xT values as .csv file</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    xT_grid <span class="op">=</span> pd.read_csv(<span class="st">'xT_grid.csv'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform xT grid into a shap</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">192</span>, <span class="dv">3</span>))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, y <span class="kw">in</span> xT_grid.iterrows():</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, x <span class="kw">in</span> xT_grid.iteritems():</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>            xT_transform[count, :] <span class="op">=</span> np.array([i, j, xT_grid.iloc[<span class="bu">int</span>(i), <span class="bu">int</span>(j)]])</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> pd.DataFrame(xT_transform)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    xT_transform.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    xT_transform.columns <span class="op">=</span> [<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'value'</span>]</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Canvas</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    pitch <span class="op">=</span> Pitch(pitch_type<span class="op">=</span><span class="st">'wyscout'</span>, line_zorder<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                  pitch_color<span class="op">=</span><span class="st">'white'</span>, line_color<span class="op">=</span><span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    pitch.draw(ax <span class="op">=</span> ax)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    bin_statistic <span class="op">=</span> pitch.bin_statistic(xT_transform.x, xT_transform.y, statistic<span class="op">=</span><span class="st">'count'</span>, bins<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    bin_statistic[<span class="st">'statistic'</span>] <span class="op">=</span> xT_grid.to_numpy()</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> pitch.heatmap(bin_statistic, ax <span class="op">=</span> ax, cmap<span class="op">=</span><span class="st">'Reds'</span>, edgecolor <span class="op">=</span> <span class="st">'#EBDECE'</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    pitch.label_heatmap(bin_statistic, color<span class="op">=</span><span class="st">'#736B65'</span>, fontsize<span class="op">=</span><span class="dv">7</span>, ax <span class="op">=</span> ax, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, zorder <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrow </span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    arrow_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>]) <span class="co"># X, Y, width, height</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    arrow_ax.arrow(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.30</span>, <span class="dv">0</span>, head_width<span class="op">=</span><span class="fl">0.03</span>, head_length<span class="op">=</span><span class="fl">0.03</span>, linewidth<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'darkgrey'</span>, length_includes_head<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_axis_off()</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    arrow_ax.annotate(<span class="st">'Direction of Play'</span>, xy <span class="op">=</span> (<span class="fl">0.42</span>, <span class="fl">0.02</span>), fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colorbar</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    ax_cbar <span class="op">=</span> fig.add_axes((<span class="fl">0.95</span>, <span class="fl">0.3</span>, <span class="fl">0.03</span>, <span class="fl">0.4</span>))</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    fig.colorbar(pt, cax <span class="op">=</span> ax_cbar).set_label(label <span class="op">=</span> <span class="st">'xT values'</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.2-passing-probability" class="level4">
<h4 class="anchored" data-anchor-id="a5.2-passing-probability">A5.2 Passing Probability</h4>
<div class="cell" data-execution_count="483">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pass_probs():</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import probability of passing as .csv file</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    xT_grid <span class="op">=</span> pd.DataFrame(pass_probs.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform xT grid into a shap</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">192</span>, <span class="dv">3</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, y <span class="kw">in</span> xT_grid.iterrows():</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, x <span class="kw">in</span> xT_grid.iteritems():</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>            xT_transform[count, :] <span class="op">=</span> np.array([i, j, xT_grid.iloc[<span class="bu">int</span>(i), <span class="bu">int</span>(j)]])</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> pd.DataFrame(xT_transform)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    xT_transform.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    xT_transform.columns <span class="op">=</span> [<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'value'</span>]</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Canvas</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    pitch <span class="op">=</span> Pitch(pitch_type<span class="op">=</span><span class="st">'wyscout'</span>, line_zorder<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                  pitch_color<span class="op">=</span><span class="st">'white'</span>, line_color<span class="op">=</span><span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getting the original colormap using cm.get_cmap() function</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    orig_map<span class="op">=</span>plt.cm.get_cmap(<span class="st">'YlOrRd'</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reversing the original colormap using reversed() function</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    reversed_map <span class="op">=</span> orig_map.<span class="bu">reversed</span>()</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    pitch.draw(ax <span class="op">=</span> ax)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    bin_statistic <span class="op">=</span> pitch.bin_statistic(xT_transform.x, xT_transform.y, statistic<span class="op">=</span><span class="st">'count'</span>, bins<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    bin_statistic[<span class="st">'statistic'</span>] <span class="op">=</span> xT_grid.to_numpy()</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> pitch.heatmap(bin_statistic, ax <span class="op">=</span> ax, cmap <span class="op">=</span> reversed_map, edgecolor <span class="op">=</span> <span class="st">'#EBDECE'</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    pitch.label_heatmap(bin_statistic, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">7</span>, ax <span class="op">=</span> ax, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, zorder <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrow </span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    arrow_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>]) <span class="co"># X, Y, width, height</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    arrow_ax.arrow(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.30</span>, <span class="dv">0</span>, head_width<span class="op">=</span><span class="fl">0.03</span>, head_length<span class="op">=</span><span class="fl">0.03</span>, linewidth<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'darkgrey'</span>, length_includes_head<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_axis_off()</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    arrow_ax.annotate(<span class="st">'Direction of Play'</span>, xy <span class="op">=</span> (<span class="fl">0.42</span>, <span class="fl">0.02</span>), fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colorbar</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    ax_cbar <span class="op">=</span> fig.add_axes((<span class="fl">0.95</span>, <span class="fl">0.3</span>, <span class="fl">0.03</span>, <span class="fl">0.4</span>))</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    fig.colorbar(pt, cax <span class="op">=</span> ax_cbar).set_label(label <span class="op">=</span> <span class="st">'$m_{x, y}$, probability of passing'</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.3-shooting-probability" class="level4">
<h4 class="anchored" data-anchor-id="a5.3-shooting-probability">A5.3 Shooting Probability</h4>
<div class="cell" data-execution_count="494">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_shot_probs():</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import probability of shooting as .csv file</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    xT_grid <span class="op">=</span> pd.DataFrame(shot_probs.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform xT grid into a shap</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">192</span>, <span class="dv">3</span>))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, y <span class="kw">in</span> xT_grid.iterrows():</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, x <span class="kw">in</span> xT_grid.iteritems():</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>            xT_transform[count, :] <span class="op">=</span> np.array([i, j, xT_grid.iloc[<span class="bu">int</span>(i), <span class="bu">int</span>(j)]])</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> pd.DataFrame(xT_transform)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    xT_transform.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    xT_transform.columns <span class="op">=</span> [<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'value'</span>]</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Canvas</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    pitch <span class="op">=</span> Pitch(pitch_type<span class="op">=</span><span class="st">'wyscout'</span>, line_zorder<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                  pitch_color<span class="op">=</span><span class="st">'white'</span>, line_color<span class="op">=</span><span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getting the original colormap using cm.get_cmap() function</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    orig_map<span class="op">=</span>plt.cm.get_cmap(<span class="st">'YlOrRd'</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reversing the original colormap using reversed() function</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    reversed_map <span class="op">=</span> orig_map.<span class="bu">reversed</span>()</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    pitch.draw(ax <span class="op">=</span> ax)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    bin_statistic <span class="op">=</span> pitch.bin_statistic(xT_transform.x, xT_transform.y, statistic<span class="op">=</span><span class="st">'count'</span>, bins<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    bin_statistic[<span class="st">'statistic'</span>] <span class="op">=</span> xT_grid.to_numpy()</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> pitch.heatmap(bin_statistic, ax <span class="op">=</span> ax, cmap <span class="op">=</span> reversed_map, edgecolor <span class="op">=</span> <span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    pitch.label_heatmap(bin_statistic, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">7</span>, ax <span class="op">=</span> ax, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, zorder <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrow </span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    arrow_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>]) <span class="co"># X, Y, width, height</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    arrow_ax.arrow(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.30</span>, <span class="dv">0</span>, head_width<span class="op">=</span><span class="fl">0.03</span>, head_length<span class="op">=</span><span class="fl">0.03</span>, linewidth<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'darkgrey'</span>, length_includes_head<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_axis_off()</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    arrow_ax.annotate(<span class="st">'Direction of Play'</span>, xy <span class="op">=</span> (<span class="fl">0.42</span>, <span class="fl">0.02</span>), fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colorbar</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    ax_cbar <span class="op">=</span> fig.add_axes((<span class="fl">0.95</span>, <span class="fl">0.3</span>, <span class="fl">0.03</span>, <span class="fl">0.4</span>))</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    fig.colorbar(pt, cax <span class="op">=</span> ax_cbar).set_label(label <span class="op">=</span> <span class="st">'$s_{x, y}$, probability of shooting'</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.4-scoring-probability" class="level4">
<h4 class="anchored" data-anchor-id="a5.4-scoring-probability">A5.4 Scoring Probability</h4>
<div class="cell" data-execution_count="486">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_score_probs():</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import probability of scoring as .csv file</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    xT_grid <span class="op">=</span> pd.DataFrame(score_probs.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform xT grid into a shap</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="dv">192</span>, <span class="dv">3</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, y <span class="kw">in</span> xT_grid.iterrows():</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, x <span class="kw">in</span> xT_grid.iteritems():</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>            xT_transform[count, :] <span class="op">=</span> np.array([i, j, xT_grid.iloc[<span class="bu">int</span>(i), <span class="bu">int</span>(j)]])</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    xT_transform <span class="op">=</span> pd.DataFrame(xT_transform)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    xT_transform.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    xT_transform.columns <span class="op">=</span> [<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'value'</span>]</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Canvas</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heatmap</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    pitch <span class="op">=</span> Pitch(pitch_type<span class="op">=</span><span class="st">'wyscout'</span>, line_zorder<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>                  pitch_color<span class="op">=</span><span class="st">'white'</span>, line_color<span class="op">=</span><span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getting the original colormap using cm.get_cmap() function</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    orig_map<span class="op">=</span>plt.cm.get_cmap(<span class="st">'summer'</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reversing the original colormap using reversed() function</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    reversed_map <span class="op">=</span> orig_map.<span class="bu">reversed</span>()</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    pitch.draw(ax <span class="op">=</span> ax)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>    bin_statistic <span class="op">=</span> pitch.bin_statistic(xT_transform.x, xT_transform.y, statistic<span class="op">=</span><span class="st">'count'</span>, bins<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    bin_statistic[<span class="st">'statistic'</span>] <span class="op">=</span> xT_grid.to_numpy()</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> pitch.heatmap(bin_statistic, ax <span class="op">=</span> ax, cmap <span class="op">=</span> reversed_map, edgecolor <span class="op">=</span> <span class="st">'#C3D2A3'</span>)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    pitch.label_heatmap(bin_statistic, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">7</span>, ax <span class="op">=</span> ax, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, zorder <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrow </span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    arrow_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>]) <span class="co"># X, Y, width, height</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    arrow_ax.arrow(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.30</span>, <span class="dv">0</span>, head_width<span class="op">=</span><span class="fl">0.03</span>, head_length<span class="op">=</span><span class="fl">0.03</span>, linewidth<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'darkgrey'</span>, length_includes_head<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    arrow_ax.set_axis_off()</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    arrow_ax.annotate(<span class="st">'Direction of Play'</span>, xy <span class="op">=</span> (<span class="fl">0.42</span>, <span class="fl">0.02</span>), fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colorbar</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    ax_cbar <span class="op">=</span> fig.add_axes((<span class="fl">0.95</span>, <span class="fl">0.3</span>, <span class="fl">0.03</span>, <span class="fl">0.4</span>))</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>    fig.colorbar(pt, cax <span class="op">=</span> ax_cbar).set_label(label <span class="op">=</span> <span class="st">'$xG_{x, y}$, probability of scoring'</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.5-xt-values-for-bundesliga-players" class="level4">
<h4 class="anchored" data-anchor-id="a5.5-xt-values-for-bundesliga-players">A5.5 xT values for Bundesliga Players</h4>
<div class="cell" data-execution_count="586">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_bundesliga():</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import Bundesliga xT results</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    bl10 <span class="op">=</span> pd.read_csv(<span class="st">"bundesliga/top10_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    bly10 <span class="op">=</span> pd.read_csv(<span class="st">"bundesliga/top10_young_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check how colormap looks</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    cm.get_cmap(<span class="st">'Blues'</span>, <span class="dv">4</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For LinearSegmented use (no 'colors' attribute):</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'Greens'</span>, <span class="dv">10</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].barh(bl10[<span class="st">"nickname"</span>], bl10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    font <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">12</span>,</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    font2 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">10</span>,</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"Top 10 Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'Reds'</span>, <span class="dv">10</span>)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].barh(bly10[<span class="st">"nickname"</span>], bly10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="st">"Top 10 Young Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set the spacing between subplots</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(left <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                        bottom <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>                        right <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>                        top <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>                        wspace <span class="op">=</span> <span class="fl">0.65</span>, </span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>                        hspace <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>    font3 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'bold'</span>,</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">14</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>    font4 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'style'</span>: <span class="st">'italic'</span>,</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">8</span>,</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">'xT per 90 for Bundesliga Players | 2017/2018 Season'</span>, x <span class="op">=</span> <span class="fl">0.842</span>, y <span class="op">=</span> <span class="fl">2.133</span>, fontproperties <span class="op">=</span> font3)</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.55</span>, y <span class="op">=</span> <span class="fl">1.15</span>, s <span class="op">=</span> <span class="st">"Only young players aged &lt;= 21 are included."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.55</span>, y <span class="op">=</span> <span class="fl">1.12</span>, s <span class="op">=</span> <span class="st">"All players played at least 900 minutes."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.6-xt-values-for-epl-players" class="level4">
<h4 class="anchored" data-anchor-id="a5.6-xt-values-for-epl-players">A5.6 xT values for EPL Players</h4>
<div class="cell" data-execution_count="595">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_epl():</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import EPL xT results</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    epl10 <span class="op">=</span> pd.read_csv(<span class="st">"epl/top10_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    eply10 <span class="op">=</span> pd.read_csv(<span class="st">"epl/top10_young_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check how colormap looks</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    cm.get_cmap(<span class="st">'Blues'</span>, <span class="dv">4</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For LinearSegmented use (no 'colors' attribute):</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'Blues'</span>, <span class="dv">10</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].barh(epl10[<span class="st">"nickname"</span>], epl10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    font <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">12</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    font2 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">10</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"Top 10 Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'Oranges'</span>, <span class="dv">10</span>)</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].barh(eply10[<span class="st">"nickname"</span>], eply10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="st">"Top 10 Young Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set the spacing between subplots</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(left <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>                        bottom <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>                        right <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>                        top <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>                        wspace <span class="op">=</span> <span class="fl">0.65</span>, </span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>                        hspace <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>    font3 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'bold'</span>,</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">14</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>    font4 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'style'</span>: <span class="st">'italic'</span>,</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">8</span>,</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">'xT per 90 for EPL Players | 2017/2018 Season'</span>, x <span class="op">=</span> <span class="fl">0.74</span>, y <span class="op">=</span> <span class="fl">2.133</span>, fontproperties <span class="op">=</span> font3)</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.6</span>, y <span class="op">=</span> <span class="fl">1.15</span>, s <span class="op">=</span> <span class="st">"Only young players aged &lt;= 21 are included."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.6</span>, y <span class="op">=</span> <span class="fl">1.12</span>, s <span class="op">=</span> <span class="st">"All players played at least 900 minutes."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.7-xt-values-for-laliga-players" class="level4">
<h4 class="anchored" data-anchor-id="a5.7-xt-values-for-laliga-players">A5.7 xT values for LaLiga Players</h4>
<div class="cell" data-execution_count="596">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_laliga():</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import LaLiga xT results</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    ll10 <span class="op">=</span> pd.read_csv(<span class="st">"laliga/top10_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    lly10 <span class="op">=</span> pd.read_csv(<span class="st">"laliga/top10_young_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For LinearSegmented use (no 'colors' attribute):</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'Greys'</span>, <span class="dv">10</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].barh(ll10[<span class="st">"nickname"</span>], ll10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    font <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">12</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    font2 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">10</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"Top 10 Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'RdPu'</span>, <span class="dv">10</span>)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].barh(lly10[<span class="st">"nickname"</span>], lly10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="st">"Top 10 Young Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set the spacing between subplots</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(left <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>                        bottom <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>                        right <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>                        top <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>                        wspace <span class="op">=</span> <span class="fl">0.65</span>, </span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>                        hspace <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>    font3 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'bold'</span>,</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">14</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>    font4 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'style'</span>: <span class="st">'italic'</span>,</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">8</span>,</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">'xT per 90 for LaLiga Players | 2017/2018 Season'</span>, x <span class="op">=</span> <span class="fl">0.79</span>, y <span class="op">=</span> <span class="fl">2.133</span>, fontproperties <span class="op">=</span> font3)</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.55</span>, y <span class="op">=</span> <span class="fl">1.15</span>, s <span class="op">=</span> <span class="st">"Only young players aged &lt;= 21 are included."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.55</span>, y <span class="op">=</span> <span class="fl">1.12</span>, s <span class="op">=</span> <span class="st">"All players played at least 900 minutes."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a5.8-xt-values-for-ligue-1-players" class="level4">
<h4 class="anchored" data-anchor-id="a5.8-xt-values-for-ligue-1-players">A5.8 xT values for Ligue 1 Players</h4>
<div class="cell" data-execution_count="598">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_ligue1():</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import Ligue 1 xT results</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    l10 <span class="op">=</span> pd.read_csv(<span class="st">"ligue1/top10_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    ly10 <span class="op">=</span> pd.read_csv(<span class="st">"ligue1/top10_young_players.csv"</span>).sort_values(by <span class="op">=</span> <span class="st">'xt_per_90'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For LinearSegmented use (no 'colors' attribute):</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'GnBu'</span>, <span class="dv">10</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].barh(l10[<span class="st">"nickname"</span>], l10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    font <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">12</span>,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    font2 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'normal'</span>,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">10</span>,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"Top 10 Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#############################################################################################</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.get_cmap(<span class="st">'PuRd'</span>, <span class="dv">10</span>)</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(color<span class="op">=</span><span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].barh(ly10[<span class="st">"nickname"</span>], ly10[<span class="st">"xt_per_90"</span>], height <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>           color <span class="op">=</span> colors(<span class="bu">range</span>(<span class="dv">10</span>)), edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Player"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_xlabel(<span class="st">"xT per 90"</span>, fontdict <span class="op">=</span> font2)</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="st">"Top 10 Young Players"</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">10</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set the spacing between subplots</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(left <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>                        bottom <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>                        right <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>                        top <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>                        wspace <span class="op">=</span> <span class="fl">0.65</span>, </span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>                        hspace <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>    font3 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: <span class="st">'bold'</span>,</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">14</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>    font4 <span class="op">=</span> {<span class="st">'family'</span>: <span class="st">'monospace'</span>,</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'style'</span>: <span class="st">'italic'</span>,</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">8</span>,</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">'xT per 90 for Ligue 1 Players | 2017/2018 Season'</span>, x <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">2.133</span>, fontproperties <span class="op">=</span> font3)</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.6</span>, y <span class="op">=</span> <span class="fl">1.15</span>, s <span class="op">=</span> <span class="st">"Only young players aged &lt;= 21 are included."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>    fig.text(x <span class="op">=</span> <span class="fl">1.6</span>, y <span class="op">=</span> <span class="fl">1.12</span>, s <span class="op">=</span> <span class="st">"All players played at least 900 minutes."</span>, fontdict <span class="op">=</span> font4)</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>